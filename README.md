# Проект "Решение SQL задач по курсу"

На практике применить SQL знания, изученные в модулях курса

В проекте использованы 4 базы данных MySQL:
- транспортные средства;
- автомобильные гонки;
- бронирование отелей;
- структура организации.


## База данных 1. Транспортные средства.

База данных vehicles включает четыре таблицы Vehicle, Car, Motorcycle и Bicycle.  

### Порядок действий:
1. Создадим БД vehicles.
2. Создадим таблицы - запустим скрипт databases/vehicles/create_tables.sql.
3. Наполним таблицы данными - запустим скрипт databases/vehicles/insert_data.sql.

### Задача 1.
Условие:
Найдите производителей (maker) и модели всех мотоциклов, которые имеют мощность более 150 лошадиных сил, 
стоят менее 20 тысяч долларов и являются спортивными (тип Sport). Также отсортируйте результаты 
по мощности в порядке убывания.

Решение находится в скрипте databases/vehicles/task1.sql.

### Задача 2.
Условие

Найти информацию о производителях и моделях различных типов транспортных средств 
(автомобили, мотоциклы и велосипеды), которые соответствуют заданным критериям.

1. Автомобили:
Извлечь данные о всех автомобилях, которые имеют:

Мощность двигателя более 150 лошадиных сил.
Объем двигателя менее 3 литров.
Цену менее 35 тысяч долларов.

В выводе должны быть указаны производитель (maker), номер модели (model), мощность (horsepower), 
объем двигателя (engine_capacity) и тип транспортного средства, который будет обозначен как Car.

2. Мотоциклы:
Извлечь данные о всех мотоциклах, которые имеют:

Мощность двигателя более 150 лошадиных сил.
Объем двигателя менее 1,5 литров.
Цену менее 20 тысяч долларов.

В выводе должны быть указаны производитель (maker), номер модели (model), мощность (horsepower), 
объем двигателя (engine_capacity) и тип транспортного средства, который будет обозначен как Motorcycle.

3. Велосипеды:
Извлечь данные обо всех велосипедах, которые имеют:

Количество передач больше 18.
Цену менее 4 тысяч долларов.

В выводе должны быть указаны производитель (maker), номер модели (model), а также NULL для мощности и 
объема двигателя, так как эти характеристики не применимы для велосипедов. Тип транспортного средства 
будет обозначен как Bicycle.

4. Сортировка:
Результаты должны быть объединены в один набор данных и отсортированы по мощности в порядке убывания. 
Для велосипедов, у которых нет значения мощности, они будут располагаться внизу списка.

Решение находится в скрипте databases/vehicles/task2.sql.


## База данных 2. Автомобильные гонки.

Базы данных car_races включает четыре таблицы: Classes, Cars, Races, Results

### Порядок действий:
1. Создадим БД car_races.
2. Создадим таблицы - запустим скрипт databases/car_races/create_tables.sql.
3. Наполним таблицы - запустим скрипт databases/car_races/insert_data.sql.

### Задачи:
#### Задача 1.
Условие:
Определить, какие автомобили из каждого класса имеют наименьшую среднюю позицию в гонках, и вывести 
информацию о каждом таком автомобиле для данного класса, включая его класс, среднюю позицию 
и количество гонок, в которых он участвовал. 
Также отсортировать результаты по средней позиции.

Решение находится в скрипте databases/car_races/task1.sql.

#### Задача 2.
Условие:
Определить автомобиль, который имеет наименьшую среднюю позицию в гонках среди всех автомобилей, 
и вывести информацию об этом автомобиле, включая его класс, среднюю позицию, количество гонок, 
в которых он участвовал, и страну производства класса автомобиля. 
Если несколько автомобилей имеют одинаковую наименьшую среднюю позицию, 
выбрать один из них по алфавиту (по имени автомобиля).

Решение находится в скрипте databases/car_races/task2.sql.

#### Задача 3.
Условие:
Определить классы автомобилей, которые имеют наименьшую среднюю позицию в гонках, и вывести 
информацию о каждом автомобиле из этих классов, включая его имя, среднюю позицию, количество гонок, 
в которых он участвовал, страну производства класса автомобиля, а также общее количество гонок, 
в которых участвовали автомобили этих классов. 
Если несколько классов имеют одинаковую среднюю позицию, выбрать все из них.

Решение находится в скрипте databases/car_races/task3.sql.

#### Задача 4.
Условие:
Определить, какие автомобили имеют среднюю позицию лучше (меньше) средней позиции всех автомобилей 
в своем классе (то есть автомобилей в классе должно быть минимум два, чтобы выбрать один из них). 
Вывести информацию об этих автомобилях, включая их имя, класс, среднюю позицию, количество гонок, 
в которых они участвовали, и страну производства класса автомобиля. 
Также отсортировать результаты по классу и затем по средней позиции в порядке возрастания.

Решение находится в скрипте databases/car_races/task4.sql.

#### Задача 5.
Условие:
Определить, какие классы автомобилей имеют наибольшее количество автомобилей с низкой средней
позицией (больше 3.0) и вывести информацию о каждом автомобиле из этих классов, включая его имя, 
класс, среднюю позицию, количество гонок, в которых он участвовал, страну производства класса 
автомобиля, а также общее количество гонок для каждого класса. Отсортировать результаты по 
количеству автомобилей с низкой средней позицией.

Решение находится в скрипте databases/car_races/task5.sql.

## База данных 3. Бронирование отелей.

Базы данных hotels_booking включает четыре таблицы: Hotel, Room, Customer, Booking.


### Подготовительный этап:
1. Создадим БД hotels_booking.
2. Создадим таблицы - запустим скрипт databases/hotels_booking/create_tables.sql.
3. Наполним таблицы - запустим скрипт databases/hotels_booking/insert_data.sql.

### Задачи:
#### Задача 1.
Условие:
Определить, какие клиенты сделали более двух бронирований в разных отелях, и вывести 
информацию о каждом таком клиенте, включая его имя, электронную почту, телефон, общее 
количество бронирований, а также список отелей, в которых они бронировали номера 
(объединенные в одно поле через запятую с помощью CONCAT). Также подсчитать среднюю 
длительность их пребывания (в днях) по всем бронированиям. Отсортировать результаты 
по количеству бронирований в порядке убывания.

Решение находится в скрипте databases/hotels_booking/task1.sql.

#### Задача 2.
Условие:
Необходимо провести анализ клиентов, которые сделали более двух бронирований в разных 
отелях и потратили более 500 долларов на свои бронирования. 
Для этого:
Определить клиентов, которые сделали более двух бронирований и забронировали номера 
в более чем одном отеле. Вывести для каждого такого клиента следующие данные: 
ID_customer, имя, общее количество бронирований, общее количество уникальных отелей,
в которых они бронировали номера, и общую сумму, потраченную на бронирования. 

Также определить клиентов, которые потратили более 500 долларов на бронирования, и вывести
для них ID_customer, имя, общую сумму, потраченную на бронирования, и общее 
количество бронирований. 

В результате объединить данные из первых двух пунктов, чтобы получить список клиентов,
которые соответствуют условиям обоих запросов. 
Отобразить поля: ID_customer, имя, общее количество бронирований, общую сумму, потраченную на
бронирования, и общее количество уникальных отелей. 

Результаты отсортировать по общей сумме, потраченной клиентами, в порядке возрастания.

Решение находится в скрипте databases/hotels_booking/task2.sql.

#### Задача 3.
Условие:
Вам необходимо провести анализ данных о бронированиях в отелях и определить предпочтения
клиентов по типу отелей. Для этого выполните следующие шаги:

1. Категоризация отелей.
Определите категорию каждого отеля на основе средней стоимости номера:

«Дешевый»: средняя стоимость менее 175 долларов.
«Средний»: средняя стоимость от 175 до 300 долларов.
«Дорогой»: средняя стоимость более 300 долларов.

2. Анализ предпочтений клиентов.
Для каждого клиента определите предпочитаемый тип отеля на основании условия ниже:

Если у клиента есть хотя бы один «дорогой» отель, присвойте ему категорию «дорогой».
Если у клиента нет «дорогих» отелей, но есть хотя бы один «средний», присвойте ему 
категорию «средний».
Если у клиента нет «дорогих» и «средних» отелей, но есть «дешевые», присвойте ему 
категорию предпочитаемых отелей «дешевый».

3. Вывод информации.
Выведите для каждого клиента следующую информацию:

ID_customer: уникальный идентификатор клиента.
name: имя клиента.
preferred_hotel_type: предпочитаемый тип отеля.
visited_hotels: список уникальных отелей, которые посетил клиент.

4. Сортировка результатов.
Отсортируйте клиентов так, чтобы сначала шли клиенты с «дешевыми» отелями, 
затем со «средними» и в конце — с «дорогими».

Решение находится в скрипте databases/hotels_booking/task3.sql.

## База данных 4. Структура организации.

Базы данных company_structure включает пятm таблиц: Departments, Roles, Employees, Projects и Tasks.

### Порядок действий:
1. Создадим БД company_structure.
2. Создадим таблицы - запустим скрипт databases/company_structure/create_tables.sql.
3. Наполним таблицы - запустим скрипт databases/company_structure/insert_data.sql.


### Задачи:
#### Задача 1.
Условие:
Найти всех сотрудников, подчиняющихся Ивану Иванову (с EmployeeID = 1), включая их подчиненных
и подчиненных подчиненных. Для каждого сотрудника вывести следующую информацию:

1. EmployeeID: идентификатор сотрудника.
2. Имя сотрудника.
3. ManagerID: Идентификатор менеджера.
4. Название отдела, к которому он принадлежит.
5. Название роли, которую он занимает.
6. Название проектов, к которым он относится (если есть, конкатенированные в одном столбце через запятую).
7. Название задач, назначенных этому сотруднику (если есть, конкатенированные в одном столбце через запятую).
8. Если у сотрудника нет назначенных проектов или задач, отобразить NULL.

Требования:
Рекурсивно извлечь всех подчиненных сотрудников Ивана Иванова и их подчиненных.
Для каждого сотрудника отобразить информацию из всех таблиц.
Результаты должны быть отсортированы по имени сотрудника.
Решение задачи должно представлять из себя один sql-запрос и задействовать ключевое слово RECURSIVE.

Решение находится в скрипте databases/company_structure/task1.sql.

#### Задача 2.
Условие:
Найти всех сотрудников, подчиняющихся Ивану Иванову с EmployeeID = 1, включая их подчиненных и подчиненных подчиненных. Для каждого сотрудника вывести следующую информацию:

1. EmployeeID: идентификатор сотрудника.
2. Имя сотрудника.
3. Идентификатор менеджера.
4. Название отдела, к которому он принадлежит.
5. Название роли, которую он занимает.
6. Название проектов, к которым он относится (если есть, конкатенированные в одном столбце).
7. Название задач, назначенных этому сотруднику (если есть, конкатенированные в одном столбце).
8. Общее количество задач, назначенных этому сотруднику.
9. Общее количество подчиненных у каждого сотрудника (не включая подчиненных их подчиненных).
10. Если у сотрудника нет назначенных проектов или задач, отобразить NULL.

Решение находится в скрипте databases/company_structure/task2.sql.

#### Задача 3.
Условие:
Найти всех сотрудников, которые занимают роль менеджера и имеют подчиненных  (то есть число 
подчиненных больше 0). Для каждого такого сотрудника вывести следующую информацию:

1. EmployeeID: идентификатор сотрудника.
2. Имя сотрудника.
3. Идентификатор менеджера.
4. Название отдела, к которому он принадлежит.
5. Название роли, которую он занимает.
6. Название проектов, к которым он относится (если есть, конкатенированные в одном столбце).
7. Название задач, назначенных этому сотруднику (если есть, конкатенированные в одном столбце).
8. Общее количество подчиненных у каждого сотрудника (включая их подчиненных).
9. Если у сотрудника нет назначенных проектов или задач, отобразить NULL.

Решение находится в скрипте databases/company_structure/task3.sql.